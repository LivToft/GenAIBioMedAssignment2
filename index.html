
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://https://genaibiomed.github.io/GenAIBioMedAssignment2/">
      
      
      
        <link rel="next" href="disk_space/">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>CMU 11781/02741 Generative AI for Biomedicine 2025 Fall Assignments</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.84d31ad4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#assignment-2-using-evo2-embeddings-to-predict-the-3d-folding-of-chromatin" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="CMU 11781/02741 Generative AI for Biomedicine 2025 Fall Assignments" class="md-header__button md-logo" aria-label="CMU 11781/02741 Generative AI for Biomedicine 2025 Fall Assignments" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CMU 11781/02741 Generative AI for Biomedicine 2025 Fall Assignments
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="CMU 11781/02741 Generative AI for Biomedicine 2025 Fall Assignments" class="md-nav__button md-logo" aria-label="CMU 11781/02741 Generative AI for Biomedicine 2025 Fall Assignments" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CMU 11781/02741 Generative AI for Biomedicine 2025 Fall Assignments
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-environment-setup" class="md-nav__link">
    <span class="md-ellipsis">
      1. Environment Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Environment Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evo2-environment-for-model-fine-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      Evo2 Environment (for model fine-tuning)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixing-a-version-issue-with-glibc-follow-these-instructions-carefully" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing a version issue with glibc (follow these instructions carefully)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-data-paths-and-huggingface-cache-dir" class="md-nav__link">
    <span class="md-ellipsis">
      2. Data paths and Huggingface cache dir
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Data paths and Huggingface cache dir">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#huggingface-cache-directory-for-model-weights" class="md-nav__link">
    <span class="md-ellipsis">
      Huggingface Cache Directory (for model weights)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataset-path" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset Path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-finetuning-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Finetuning &amp; Evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Finetuning &amp; Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-integrate-with-wandb-for-experiment-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      a) Integrate with wandb (for experiment tracking)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-run-finetuning-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      b) Run Finetuning &amp; Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-towards-better-performance" class="md-nav__link">
    <span class="md-ellipsis">
      c) Towards better performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-visualize-predictions-analyze-performance" class="md-nav__link">
    <span class="md-ellipsis">
      d) Visualize Predictions &amp; Analyze Performance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-analysis-submission" class="md-nav__link">
    <span class="md-ellipsis">
      4. Analysis &amp; Submission
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="disk_space/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Note on Disk Space
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-environment-setup" class="md-nav__link">
    <span class="md-ellipsis">
      1. Environment Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Environment Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#evo2-environment-for-model-fine-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      Evo2 Environment (for model fine-tuning)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fixing-a-version-issue-with-glibc-follow-these-instructions-carefully" class="md-nav__link">
    <span class="md-ellipsis">
      Fixing a version issue with glibc (follow these instructions carefully)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-data-paths-and-huggingface-cache-dir" class="md-nav__link">
    <span class="md-ellipsis">
      2. Data paths and Huggingface cache dir
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Data paths and Huggingface cache dir">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#huggingface-cache-directory-for-model-weights" class="md-nav__link">
    <span class="md-ellipsis">
      Huggingface Cache Directory (for model weights)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dataset-path" class="md-nav__link">
    <span class="md-ellipsis">
      Dataset Path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-finetuning-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Finetuning &amp; Evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Finetuning &amp; Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-integrate-with-wandb-for-experiment-tracking" class="md-nav__link">
    <span class="md-ellipsis">
      a) Integrate with wandb (for experiment tracking)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-run-finetuning-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      b) Run Finetuning &amp; Evaluation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-towards-better-performance" class="md-nav__link">
    <span class="md-ellipsis">
      c) Towards better performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-visualize-predictions-analyze-performance" class="md-nav__link">
    <span class="md-ellipsis">
      d) Visualize Predictions &amp; Analyze Performance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-analysis-submission" class="md-nav__link">
    <span class="md-ellipsis">
      4. Analysis &amp; Submission
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="assignment-2-using-evo2-embeddings-to-predict-the-3d-folding-of-chromatin">Assignment 2: Using Evo2 embeddings to Predict the 3D Folding of Chromatin</h1>
<h2 id="overview">Overview</h2>
<p>The <a href="https://www.biorxiv.org/content/10.1101/2025.01.06.631595v1.full.pdf"><code>DNALongBench</code></a> paper introduced a set of challenging problems in genomics that require understanding long-range dependencies in DNA. One of the most difficult tasks is predicting the 3D folding of chromatin (a "contact map") from a 1D DNA sequence of over 1 million base pairs.</p>
<p><img alt="DNALongBench Overview" src="https://github.com/ma-compbio/DNALONGBENCH/raw/main/Figure1.v3.png" /></p>
<p>In this assignment, you will use <strong>Evo2</strong> (7B), a DNA foundation model, on this <strong>Contact Map Prediction</strong> task. Ideally we would like to finetune the whole 7B model for this task, however, for simplicity, we will use the embeddings of this model to train a lightweight prediction head that learns to map these complex DNA features into a final contact map.</p>
<p>You will learn to manage a complex deep learning environment, use Weights &amp; Biases (<code>wandb</code>) for experiment tracking, and visually analyze the model's predictions to interpret what it has learned.</p>
<hr />
<h2 id="1-environment-setup">1. Environment Setup</h2>
<p><mark><strong>IMPORTANT Note 1:</strong> This assignment requires access to <strong>NVIDIA H100 GPUs</strong> (Since Evo2 requires device compute capability 8.9 or higher required for FP8 execution). 
You must first request a GPU node on the cluster <em>before</em> setting up the Conda environments. This ensures that Conda can <a href="https://github.com/conda-forge/tensorflow-feedstock/issues/174#issuecomment-1031003478">correctly detect the CUDA toolkit</a>.</mark></p>
<p><mark><strong>IMPORTANT Note 2:</strong> This assignment needs at least 18GB for the evo2 environment, <a href="disk_space/">read this</a> on how to get some free space on your PSC home directory.</mark></p>
<hr />
<p><strong>Example: Requesting a GPU Node (SLURM)</strong></p>
<p><strong>A Note on HPC Etiquette:</strong> Please use short, interactive srun sessions (e.g., --time=0:40:00) for setup and debugging. For the final, long-running training, always submit a non-interactive batch (sbatch) job. This is the standard and most considerate way to use shared GPU resources. This practice ensures that valuable GPU time is reserved for active computation, benefiting all users on the cluster.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>srun<span class="w"> </span>--partition<span class="o">=</span>GPU-shared<span class="w"> </span>--gres<span class="o">=</span>gpu:h100-80:1<span class="w"> </span>--time<span class="o">=</span><span class="m">0</span>:40:00<span class="w"> </span>--account<span class="o">=</span>cis250160p<span class="w"> </span>--pty<span class="w"> </span>bash
</span></code></pre></div>
<h3 id="evo2-environment-for-model-fine-tuning"><strong>Evo2 Environment (for model fine-tuning)</strong></h3>
<p>You will need to run the following commmands everytime you attempt to train the model.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>module<span class="w"> </span>load<span class="w"> </span>anaconda3/2024.10-1
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>module<span class="w"> </span>load<span class="w"> </span>cuda/12.4.0
</span></code></pre></div></p>
<p>Create a conda evnvironment named <code>evo2</code> with Python 3.12 and install the required packages.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>evo2<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.12<span class="w"> </span>-y
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>conda<span class="w"> </span>activate<span class="w"> </span>evo2
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>transformer-engine-torch<span class="o">=</span><span class="m">2</span>.3.0
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>pip<span class="w"> </span>install<span class="w"> </span>flash-attn<span class="o">==</span><span class="m">2</span>.8.0.post2<span class="w"> </span>--no-build-isolation
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>pip<span class="w"> </span>install<span class="w"> </span>evo2
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>pip<span class="w"> </span>install<span class="w"> </span>natsort
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">tensorflow</span><span class="o">==</span><span class="m">2</span>.17.0
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>pip<span class="w"> </span>install<span class="w"> </span>wandb
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>pip<span class="w"> </span>install<span class="w"> </span>matplotlib<span class="w"> </span>scipy
</span></code></pre></div>
<h3 id="fixing-a-version-issue-with-glibc-follow-these-instructions-carefully"><strong>Fixing a version issue with glibc (follow these instructions carefully)</strong></h3>
<p><img alt="" height="400" src="images/glibc.png" title="" width="400" /></p>
<p>After setting up the environment, you will need to fix a dependency issue.
Flash-attn package requires <code>GLIBC_2.32</code>, while PSC has the version 2.28.</p>
<p>Follow the following steps mentioned in this <a href="https://github.com/Dao-AILab/flash-attention/issues/1708#issuecomment-3283420504">github comment</a> by <code>NewComer00</code>. </p>
<ol>
<li>Build polyfill-glibc with feat/single-threaded support</li>
<li>Get the path to flash-attn's .so lib</li>
<li>Get your current GLIBC version</li>
<li>Patch flash-attn's .so lib</li>
</ol>
<p>After you perform these steps, in the evo2 environement try running this command <code>python3 -c "import flash_attn"</code>. If it succeeds without error, you are good to go! Now you have a conda environment that supports Evo2 and Flash-attn! </p>
<p>This step is somewhat tricky, if you are having trouble at this step, make a post on <a href="https://edstem.org/us/courses/83150/discussion">edstem</a>.</p>
<hr />
<h2 id="2-data-paths-and-huggingface-cache-dir">2. Data paths and Huggingface cache dir</h2>
<p>Great job getting the environment set up! Working through dependency issues is a key skill when setting up advanced deep learning models. You often need to spend time reading github issues, searching for similar questions people have faced, and try to narrow down the issue you face.</p>
<h3 id="huggingface-cache-directory-for-model-weights">Huggingface Cache Directory (for model weights)</h3>
<p>We have downloaded the Evo2 7B model weights on PSC. Therefore run this command to make sure huggingface looks at the correct location for the model weights. Otherwise it will download the weights to your home directory which has limited space.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">HF_HOME</span><span class="o">=</span>/ocean/projects/cis250160p/rhettiar
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export HF_HOME=/ocean/projects/cis250160p/rhettiar&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc<span class="p">;</span>
</span></code></pre></div>
<p>This line adds the environment variable to your <code>.bashrc</code> file, so it is set automatically in future sessions. After completing the assignment, remove this line from your <code>.bashrc</code>.</p>
<h3 id="dataset-path">Dataset Path</h3>
<p>We have downloaded the <strong>Contact Map Prediction</strong> dataset and have placed it in the shared directory (<code>/ocean/projects/cis250160p/rhettiar/contact_map_prediction/</code>). Try navigating to that directory (<code>cd</code>) to check if you can see the dataset. </p>
<p>The scripts that you will use for fintuning already has this path set as the default data path. Therefore, if you plan to run the scripts on a different cluster make sure to edit <code>data_path</code>.</p>
<p>If you are running on PSC, the dataloader will automatically use this path to load the data. If you are running on a different machine, download the dataset from <a href="https://dataverse.harvard.edu/citation?persistentId=doi:10.7910/DVN/AZM25S">this link</a>.</p>
<p><strong>Note:</strong> For reduced train time, we are only using <code>test-0.tfr</code>  <code>train-0.tfr</code>  <code>valid-0.tfr</code> from this contact map dataset.</p>
<hr />
<h2 id="3-finetuning-evaluation">3. Finetuning &amp; Evaluation</h2>
<p><img alt="" height="400" src="images/train.png" title="" width="400" /></p>
<p>Clone this assignemnt 2 repository to your working directory.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/GenAIBioMed/GenAIBioMedAssignment2
</span></code></pre></div>
<h3 id="a-integrate-with-wandb-for-experiment-tracking">a) Integrate with <code>wandb</code> (for experiment tracking)</h3>
<p>Your first task is to edit the finetuning code (<code>finetune_contact_map.py</code>). Fill in the sections marked <code>TODO</code> to integrate Weights &amp; Biases (<code>wandb</code>) for experiment tracking. Then run finetuning with <code>python finetune_contact_map.py</code>. You can refer to this documentation when learning about wandb <a href="https://docs.wandb.ai/quickstart/">Getting Started with Weights &amp; Biases</a>.</p>
<h3 id="b-run-finetuning-evaluation">b) Run Finetuning &amp; Evaluation</h3>
<p>Activate your <code>evo2</code> environment and run the fine-tuning script. The script is configured to use the evo2_7b model by default. The lines below loads cuda and sets the huggingface cache path to the shared folder. While you can run this through an interactive job, we recommend running as a sbatch job so that the chance of a sudden interruption is low.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>conda<span class="w"> </span>activate<span class="w"> </span>evo2
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>module<span class="w"> </span>load<span class="w"> </span>cuda/12.4.0
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">HF_HOME</span><span class="o">=</span>/ocean/projects/cis250160p/rhettiar
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>python<span class="w"> </span>finetune_contact_map.py
</span></code></pre></div>
<p>After training is complete, use your best model checkpoint to run the evaluation script (this will saved model predictions and groundtruth as .npy files).</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>conda<span class="w"> </span>activate<span class="w"> </span>evo2
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>module<span class="w"> </span>load<span class="w"> </span>cuda/12.4.0
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">HF_HOME</span><span class="o">=</span>/ocean/projects/cis250160p/rhettiar
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>python<span class="w"> </span>evaluate_contact_map.py
</span></code></pre></div>
<h3 id="c-towards-better-performance">c) Towards better performance</h3>
<p>Above we have only trained for 10 epochs, and for a subset of data: <code>test-0.tfr</code>  <code>train-0.tfr</code>  <code>valid-0.tfr</code>. Try out one of the following to see how you might improve the prediction head's performance. </p>
<ul>
<li>Training for more epochs</li>
<li>Improving the prediction head architecture</li>
<li>Including more <a href="https://dataverse.harvard.edu/citation?persistentId=doi:10.7910/DVN/AZM25S">data</a> (all train-*.tfr files). (You will need to download more files, e.g. train-1.tfr, train-2.tfr and then copy them to your scratch folder -- <code>/ocean/projects/cis250160p/&lt;username&gt;</code>, then update the path variable in the scripts)</li>
</ul>
<p><mark>(⚠️ make sure to change the checkpoint saving path -- otherwise you might overwrite the default checkpoint that you trained. Same goes for the prediction saving dir as well! you may want to rename the <code>npy</code> files that you already obtained)</mark></p>
<h3 id="d-visualize-predictions-analyze-performance">d) Visualize Predictions &amp; Analyze Performance</h3>
<p>The <code>evaluate_contact_map.py</code> script saves the raw prediction and target data. You will create a new Python script (e.g., <code>analyze_performance.py</code>) to process these files.</p>
<p>Your script must perform two key tasks:</p>
<ol>
<li>
<p><strong>Calculate Overall Performance:</strong></p>
<ul>
<li>Load the <code>pred.npy</code> and <code>target.npy</code> files.</li>
<li>Iterate through every sample in the test set. For each sample, calculate the Pearson (PCC) between the predicted and the ground truth contact map.</li>
<li>Compute the <strong>average PCC</strong> across the <em>entire</em> test set. These values represent your model's overall performance.</li>
</ul>
</li>
<li>
<p><strong>Generate a Representative Visualization:</strong></p>
<ul>
<li>After calculating all scores, find a single genomic region from the test set that demonstrates good performance (e.g., its score is near or above the average).</li>
<li>Generate a plot for this single example. The figure should contain two subplots: the <strong>Ground Truth</strong> map and your <strong>Finetuned Prediction</strong>.</li>
<li>Use <code>matplotlib.pyplot.imshow</code> to display the <del>50x50</del> <span class="arithmatex"><span class="MathJax_Preview">40x40</span><script type="math/tex">40x40</script></span> matrices.</li>
<li>Clearly label each subplot with the specific PCC for that individual example.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="4-analysis-submission">4. Analysis &amp; Submission</h2>
<p>Compress the following into a single <strong>zip file</strong> for submission.</p>
<ol>
<li>
<p><strong>Modified Python Files:</strong></p>
<ul>
<li><code>finetune_contact_map.py</code> (with <code>wandb</code> integration).</li>
<li><code>analyze_performance.py</code> (the script you wrote for calculation and visualization).</li>
</ul>
</li>
<li>
<p><strong>PDF Report:</strong> </p>
<p>Your report must include the following for each of the two conditions: 1) default number of epochs, 2) one option you tried in <a href="#c-towards-better-performance">section 3c</a> (state what you tried).</p>
<ul>
<li>Report the final loss you achieve</li>
<li>
<p>A link to your public <code>wandb</code> <a href="https://docs.wandb.ai/guides/reports/create-a-report/">experiment's report</a> showing your training curves. Here's an <a href="https://wandb.ai/ramith-mit/ML_10701_HW4/reports/Example-Public-Report--VmlldzoxNDY4MjUxOQ?accessToken=id622t0rr03mvjbmgkd3lxre2f73q0zwan2s5c2zxx4r02yowsb1bpkc6tor1aj9">example</a>.</p>
</li>
<li>
<p><strong>Overall Performance Metrics:</strong> State the <strong>average PCC</strong> you calculated across the entire test set.</p>
</li>
<li><strong>Representative Visualization:</strong> Include the visualization figure you generated for a single, high-performing example. Ensure the subplots are clearly labeled with their specific scores.</li>
<li><strong>Written Analysis:</strong> Your analysis should address the following points in a few short paragraphs:<ol>
<li><strong>Performance Comparison:</strong> Based on your average scores, does your fine-tuned Evo2 model achieve better or worse performance than the CNN baseline reported in the DNALongBench <a href="https://www.biorxiv.org/content/10.1101/2025.01.06.631595v1.full.pdf">paper</a>?</li>
<li><strong>Discussion:</strong> Whether it performs better or worse, discuss potential reasons for this outcome. What could have we done in the finetuning script for better performance?</li>
</ol>
</li>
</ul>
</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>